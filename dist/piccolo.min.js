var Piccolo=function(c,b){b=b||{};var d={onready:[],onimageready:[],onimageloaded:[],onimageuploaded:[],oncropstart:[],oncropend:[],oncropcancel:[],onrotatestart:[],onrotateccw:[],onrotatecw:[],onrotateend:[],onrotatecancel:[],onreset:[]},a;b.settings={imagesdirectory:null,uploadurl:null,postvariablename:"file",multiplefileupload:!1,debug:!1};b.on=function(a,c){b.settings.debug&&console.log("Registering event: "+a);_.isFunction(c)?(a=0===a.indexOf("on")?a:"on"+a,0<=d[a].indexOf(c)||d[a].push(c),b.settings.debug&&
console.log("Registered "+d[a].length+" function(s) for event "+a)):b.settings.debug&&console.log("Event callback invalid: "+a)};b.un=function(a,c){b.settings.debug&&console.log("Unregistering event: "+a);if(_.isFunction(c)){a=0==a.indexOf("on")?a:"on"+a;var f=d[a].indexOf(c);0<=f&&d[a].splice(f,1)}};b.raise=function(a,c){var f=0;_.defer(function(){b.settings.debug&&console.log("Raising event: "+a);b.settings.debug&&console.log(d[a]);d[a]&&d[a].forEach(function(a){try{b.settings.debug&&console.log("Raising event: "+
++f),a(c)}catch(l){}})})};c.fn.piccolo=function(d){var f=c(this);b.settings.postvariablename=f.data("post")||b.settings.postvariablename;b.settings.uploadurl=f.data("url")||b.settings.uploadurl;b.settings.debug&&console.log("Init Piccolo from jQuery");a=this;b.settings=c.extend(b.settings,d);b.createDropzone(this);return this};b.on("imageready",function(c){var d=b.createImagezone(a);b.raise("onimageloaded",{target:d,source:c.source})});b.on("reset",function(c){b.createDropzone(a)});return b}(jQuery,
{});(function(c,b){var d={};b=b||{};b.createDropzone=function(a){a=c(a);a.addClass("piccolo");a.off();a.empty();var b=d.supportsFileAPI(),g=c("<div/>",{"class":"mdl-card"}),k=c("<div/>",{"class":"mdl-card__title mdl-card--expand"}),m=c("<h2/>",{"class":"mdl-card__title-text"}).text("Upload photo"),l=c("<div/>",{"class":"mdl-card__supporting-text"}).text("Drag and drop photos, or pick photo to upload."),h=c("<a/>",{"class":"mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect"}).text("Pick Photo"),
n=c("<input/>",{type:"file"}).css("display","none"),e=c("<div/>",{"class":"mdl-card__actions mdl-card--border"}).append(h);e.append(n);h.click(function(a){n.click()});n.on("change",d.handleFileSelect);k.append(m);g.append(k).append(l).append(e);a.append(g);b&&(a.on("dragover",d.handleDragOver),a.on("drop",d.handleDropzoneFileSelect),a.on("dragover",function(a){g.addClass("mdl-shadow--2dp")}),a.on("dragleave",function(a){g.removeClass("mdl-shadow--2dp")}))};d.supportsFileAPI=function(){return window.File&&
window.FileReader&&window.FileList&&window.Blob?!0:!1};d.handleDragOver=function(a){a.stopPropagation();a.preventDefault();a.originalEvent.dataTransfer.dropEffect="copy"};d.handleDropzoneFileSelect=function(a){a.stopPropagation();a.preventDefault();d.files=d.getValidFiles(a.originalEvent.dataTransfer.files);d.currentfileindex=0;d.files.length&&d.loadFileAt(d.currentfileindex)};d.handleFileSelect=function(a){a.stopPropagation();a.preventDefault();d.files=d.getValidFiles(a.originalEvent.target.files);
d.currentfileindex=0;d.files.length&&d.loadFileAt(d.currentfileindex)};d.loadFileAt=function(a){var c=window.URL||window.webkitURL;a=d.files[a];var g=new Image,k=c.createObjectURL(a);g.src=k;g.onload=function(){b.raise("onimageready",{source:g});c.revokeObjectURL(k)}};d.getValidFiles=function(a){var b=[];_.each(a,function(a){a.type.match("image.*")&&b.push(a)});return b};return b})(jQuery,Piccolo);(function(c,b){b=b||{};b.createImagezone=function(d){function a(){p.empty();l.click(r);m.click(t);k.click(u);p.append(k).append(m).append(l)}d=c(d);d.addClass("piccolo");d.off();d.empty();var f=c("<div/>",{"class":"mdl-card mdl-shadow--2dp"}),g=c("<canvas/>",{"class":"mdl-card__title mdl-card--expand canv"}),k=c("<a/>",{"class":"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab material-icons piccolo-button"}).append(c("<i/>",{"class":"material-icons"}).text("crop")),m=c("<a/>",{"class":"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab material-icons piccolo-button"}).append(c("<i/>",
{"class":"material-icons"}).text("rotate_90_degrees_ccw")),l=c("<a/>",{"class":"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab material-icons piccolo-button"}).append(c("<i/>",{"class":"material-icons"}).text("clear")),h=c("<a/>",{"class":"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab material-icons piccolo-button"}).append(c("<i/>",{"class":"material-icons"}).text("done")),n=c("<a/>",{"class":"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab material-icons piccolo-button"}).append(c("<i/>",
{"class":"material-icons"}).text("cancel")),e=c("<a/>",{"class":"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab material-icons piccolo-button"}).append(c("<i/>",{"class":"material-icons"}).text("rotate_left")),q=c("<a/>",{"class":"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab material-icons piccolo-button"}).append(c("<i/>",{"class":"material-icons"}).text("rotate_right")),p=c("<div/>",{"class":"mdl-card__actions mdl-card--border"}).append(k).append(m).append(l);f.append(g).append(p);
d.append(f);var r=function(a){b.raise("onreset",{})},t=function(d){b.raise("onrotatestart",{});h.off();n.off();h.click(function(c){b.raise("onrotateend",{});a()});e.click(function(a){b.raise("onrotateccw",{})});q.click(function(a){b.raise("onrotatecw",{})});n.click(function(c){b.raise("onrotatecancel",{});a()});p.empty();p.append(c("<span/>",{"class":"piccolo-button"}).text("Rotate")).append(h).append(e).append(q).append(n)},u=function(d){b.raise("oncropstart",{});h.off();n.off();h.click(function(c){b.raise("oncropend",
{});a()});n.click(function(c){b.raise("oncropcancel",{});a()});p.empty();p.append(c("<span/>",{"class":"piccolo-button"}).text("Crop")).append(h).append(n)};l.click(r);m.click(t);k.click(u);return g}})(jQuery,Piccolo);(function(c,b){function d(a){if(null!=b.settings.uploadurl){var c=new XMLHttpRequest;c.open("POST",b.settings.uploadurl,!0);c.setRequestHeader("Content-type","application/x-www-form-urlencoded");var d={};d[b.settings.postvariablename]=a;c.send(JSON.stringify(d))}}var a,f,g,k,m,l,h=0;b.on("cropstart",function(b){a.cropper("enable")});b.on("cropcancel",function(b){a.cropper("clear");a.cropper("disable")});b.on("cropend",function(b){a.cropper("replace",l.toDataURL());d(l.toDataURL());a.cropper("setCropData",
!1)});b.on("rotateccw",function(b){h-=45;a.cropper("enable");b=1-Math.min(m,k)/Math.sqrt(g*g+f*f);a.cropper("rotate","-45");0==h%90?a.cropper("zoom",b):a.cropper("zoom",-1*b);a.cropper("moveTo",0,0);a.cropper("disable")});b.on("rotatecw",function(b){h+=45;a.cropper("enable");b=1-Math.min(m,k)/Math.sqrt(g*g+f*f);a.cropper("rotate","45");0==h%90?a.cropper("zoom",b):a.cropper("zoom",-1*b);a.cropper("moveTo",0,0);a.cropper("disable");console.log(a[0].toDataURL())});b.on("imageloaded",function(b){var e=
c(b.target);b=b.source;a=e;e.width();e.height();var h=e[0];h.width=b.naturalWidth;h.height=b.naturalHeight;h.getContext("2d").drawImage(b,0,0,b.naturalWidth,b.naturalHeight,0,0,b.naturalWidth,b.naturalHeight);e.cropper({autoCrop:!1,rotatable:!0,cropend:function(a){l=e.cropper("getCroppedCanvas")},built:function(){d(e[0].toDataURL());f=e.next().height();g=e.next().width();var a=e.parent().height(),b=e.parent().width();k=a;m=b;e.cropper("zoom",-1*(1-f/a));e.cropper("getCanvasData");e.cropper("moveTo",
0,0);e.cropper("getCanvasData");f=e.next().height();g=e.next().width();e.cropper("disable")}})});b.on("rotatestart",function(a){});b.on("rotateend",function(a){})})(jQuery,Piccolo);
