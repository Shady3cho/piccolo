/*Piccolo v1.0.1*/
var Piccolo=function(d,a){a=a||{};var b={events:{onready:[],onimageready:[],onimageloaded:[],onimageuploaded:[],oncropstart:[],oncropend:[],oncropcancel:[],onrotatestart:[],onrotateccw:[],onrotatecw:[],onrotateend:[],onrotatecancel:[],onreset:[]}};a.settings={imagesdirectory:null,uploadurl:"../../uploads/index.php",postvariablename:"file",multiplefileupload:!1,debug:!1,preloadimage:null,imagefilename:null};a.on=function(c,e){a.settings.debug&&console.log("Registering event: "+c);_.isFunction(e)?(c=
0===c.indexOf("on")?c:"on"+c,0<=b.events[c].indexOf(e)||b.events[c].push(e),a.settings.debug&&console.log("Registered "+b.events[c].length+" function(s) for event "+c)):a.settings.debug&&console.log("Event callback invalid: "+c)};a.un=function(c,e){a.settings.debug&&console.log("Unregistering event: "+c);if(_.isFunction(e)){c=0==c.indexOf("on")?c:"on"+c;var d=b.events[c].indexOf(e);0<=d&&b.events[c].splice(d,1)}};a.raise=function(c,e){var d=0;_.defer(function(){a.settings.debug&&console.log("Raising event: "+
c);a.settings.debug&&console.log(b.events[c]);b.events[c]&&b.events[c].forEach(function(c){try{a.settings.debug&&console.log("Raising event: "+ ++d),c(e)}catch(p){}})})};b.preloadImage=function(){var c=new Image;c.src=a.settings.preloadimage;c.onload=function(){a.raise("onimageready",{source:c})}};d.fn.piccolo=function(c){var e=d(this);a.settings.postvariablename=e.data("post")||a.settings.postvariablename;a.settings.uploadurl=e.data("url")||a.settings.uploadurl;a.settings.preloadimage=e.data("image")||
a.settings.preloadimage;a.settings.debug&&console.log("Init Piccolo from jQuery");b.zone=this;a.settings=d.extend(a.settings,c);a.createDropzone(this);a.settings.preloadimage&&b.preloadImage();return this};a.on("imageready",function(c){var e=a.createImagezone(b.zone);a.raise("onimageloaded",{target:e,source:c.source})});a.on("reset",function(c){a.createDropzone(b.zone)});return a}(jQuery,{});(function(d,a){var b={};a=a||{};a.createDropzone=function(a){a=d(a);a.addClass("piccolo");a.off();a.empty();var c=b.supportsFileAPI(),h=d("<div/>",{"class":"mdl-card"}),g=d("<div/>",{"class":"mdl-card__title mdl-card--expand"}),p=d("<h2/>",{"class":"mdl-card__title-text"}).text("Upload photo"),q=d("<div/>",{"class":"mdl-card__supporting-text"}).text("Drag and drop photos, or pick photo to upload."),m=d("<a/>",{"class":"mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect"}).text("Pick Photo"),
l=d("<input/>",{type:"file"}).css("display","none"),k=d("<div/>",{"class":"mdl-card__actions mdl-card--border"}).append(m);k.append(l);m.click(function(a){l.click()});l.on("change",b.handleFileSelect);g.append(p);h.append(g).append(q).append(k);a.append(h);c&&(a.on("dragover",b.handleDragOver),a.on("drop",b.handleDropzoneFileSelect),a.on("dragover",function(a){h.addClass("mdl-shadow--2dp")}),a.on("dragleave",function(a){h.removeClass("mdl-shadow--2dp")}))};b.supportsFileAPI=function(){return window.File&&
window.FileReader&&window.FileList&&window.Blob?!0:!1};b.handleDragOver=function(a){a.stopPropagation();a.preventDefault();a.originalEvent.dataTransfer.dropEffect="copy"};b.handleDropzoneFileSelect=function(a){a.stopPropagation();a.preventDefault();b.files=b.getValidFiles(a.originalEvent.dataTransfer.files);b.currentfileindex=0;b.files.length&&b.loadFileAt(b.currentfileindex)};b.handleFileSelect=function(a){a.stopPropagation();a.preventDefault();b.files=b.getValidFiles(a.originalEvent.target.files);
b.currentfileindex=0;b.files.length&&b.loadFileAt(b.currentfileindex)};b.loadFileAt=function(c){var e=window.URL||window.webkitURL;c=b.files[c];var d=new Image,g=e.createObjectURL(c);d.src=g;d.onload=function(){a.raise("onimageready",{source:d});e.revokeObjectURL(g)}};b.getValidFiles=function(a){var b=[];_.each(a,function(a){a.type.match("image.*")&&b.push(a)});return b};return a})(jQuery,Piccolo);(function(d,a){a=a||{};a.createImagezone=function(b){function c(){f.empty();q.click(r);p.click(t);g.click(u);f.append(g).append(p).append(q)}b=d(b);b.addClass("piccolo");b.off();b.empty();var e=d("<div/>",{"class":"mdl-card mdl-shadow--2dp"}),h=d("<canvas/>",{"class":"mdl-card__title mdl-card--expand canv"}),g=d("<a/>",{"class":"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab material-icons piccolo-button"}).append(d("<i/>",{"class":"material-icons"}).text("crop")),p=d("<a/>",{"class":"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab material-icons piccolo-button"}).append(d("<i/>",
{"class":"material-icons"}).text("rotate_90_degrees_ccw")),q=d("<a/>",{"class":"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab material-icons piccolo-button"}).append(d("<i/>",{"class":"material-icons"}).text("clear")),m=d("<a/>",{"class":"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab material-icons piccolo-button"}).append(d("<i/>",{"class":"material-icons"}).text("done")),l=d("<a/>",{"class":"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab material-icons piccolo-button"}).append(d("<i/>",
{"class":"material-icons"}).text("cancel")),k=d("<a/>",{"class":"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab material-icons piccolo-button"}).append(d("<i/>",{"class":"material-icons"}).text("rotate_left")),n=d("<a/>",{"class":"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab material-icons piccolo-button"}).append(d("<i/>",{"class":"material-icons"}).text("rotate_right")),f=d("<div/>",{"class":"mdl-card__actions mdl-card--border"}).append(g).append(p).append(q);e.append(h).append(f);
b.append(e);var r=function(b){a.raise("onreset",{})},t=function(b){a.raise("onrotatestart",{});m.off();l.off();m.click(function(b){a.raise("onrotateend",{});c()});k.click(function(b){a.raise("onrotateccw",{})});n.click(function(b){a.raise("onrotatecw",{})});l.click(function(b){a.raise("onrotatecancel",{});c()});f.empty();f.append(d("<span/>",{"class":"piccolo-button"}).text("Rotate")).append(m).append(k).append(n).append(l)},u=function(b){a.raise("oncropstart",{});m.off();l.off();m.click(function(b){a.raise("oncropend",
{});c()});l.click(function(b){a.raise("oncropcancel",{});c()});f.empty();f.append(d("<span/>",{"class":"piccolo-button"}).text("Crop")).append(m).append(l)};q.click(r);p.click(t);g.click(u);return h}})(jQuery,Piccolo);(function(d,a){function b(b){if(null!=a.settings.uploadurl){var c=new XMLHttpRequest;c.open("POST",a.settings.uploadurl,!0);c.setRequestHeader("Content-type","application/x-www-form-urlencoded");var d={};d[a.settings.postvariablename]=b;d.settings=a.settings;c.onload=function(){if(c.readyState===c.DONE&&200===c.status){var b=JSON.parse(c.response).data;a.settings.imagefilename=a.settings.imagefilename||b.imagefilename;a.raise("onimageuploaded",b)}};c.send(JSON.stringify(d))}}function c(a){return a.substr(a.lastIndexOf("/")+
1)}var e,h,g,p,q,m,l,k=0;a.on("cropstart",function(a){e.cropper("enable")});a.on("cropcancel",function(a){e.cropper("clear");e.cropper("disable")});a.on("cropend",function(a){b(l.toDataURL());e.cropper("replace",l.toDataURL());e.cropper("setCropData",!1)});a.on("rotateccw",function(a){k-=45;e.cropper("enable");a=1-Math.min(q,p)/Math.sqrt(g*g+h*h);e.cropper("rotate","-45");0==k%90?e.cropper("zoom",a):e.cropper("zoom",-1*a);e.cropper("moveTo",0,0);e.cropper("disable")});a.on("rotatecw",function(a){k+=
45;e.cropper("enable");a=1-Math.min(q,p)/Math.sqrt(g*g+h*h);e.cropper("rotate","45");0==k%90?e.cropper("zoom",a):e.cropper("zoom",-1*a);e.cropper("moveTo",0,0);e.cropper("disable");console.log(e[0].toDataURL())});a.on("imageloaded",function(n){var f=d(n.target);n=n.source;a.settings.imagefilename=a.settings.imagefilename||a.settings.preloadimage&&c(a.settings.preloadimage);e=f;f.width();f.height();var k=f[0];k.width=n.naturalWidth;k.height=n.naturalHeight;k.getContext("2d").drawImage(n,0,0,n.naturalWidth,
n.naturalHeight,0,0,n.naturalWidth,n.naturalHeight);b(k.toDataURL());m=f.cropper({autoCrop:!1,rotatable:!0,cropend:function(a){l=f.cropper("getCroppedCanvas")},built:function(){h=f.next().height();g=f.next().width();var a=f.parent().height(),b=f.parent().width();p=a;q=b;f.cropper("zoom",-1*(1-h/a));f.cropper("getCanvasData");f.cropper("moveTo",0,0);f.cropper("getCanvasData");h=f.next().height();g=f.next().width();f.cropper("disable")}})});a.on("rotatestart",function(a){});a.on("rotateend",function(a){m[0].getContext("2d").rotate(45*
Math.PI/180);b(m[0].toDataURL())})})(jQuery,Piccolo);
